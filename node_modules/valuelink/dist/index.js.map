{"version":3,"file":"index.js","sources":["../lib/helpers.js","../lib/component.js","../lib/link.js"],"sourcesContent":["var ArrayProto = Array.prototype, ObjectProto = Object.prototype;\nexport function helpers(value) {\n    if (value && typeof value === 'object') {\n        switch (Object.getPrototypeOf(value)) {\n            case ArrayProto: return arrayHelpers;\n            case ObjectProto: return objectHelpers;\n        }\n    }\n    return dummyHelpers;\n}\n// Do nothing for types other than Array and plain Object.\nvar dummyHelpers = {\n    clone: function (value) { return value; },\n    map: function (link, fun) { return []; },\n    remove: function (value) { return value; }\n};\n// `map` and `clone` for plain JS objects\nexport var objectHelpers = {\n    // Map through the link to object\n    map: function (link, iterator) {\n        var mapped = [];\n        for (var key in link.value) {\n            var element = iterator(link.at(key), key);\n            element === void 0 || (mapped.push(element));\n        }\n        return mapped;\n    },\n    remove: function (object, key) {\n        delete object[key];\n        return object;\n    },\n    // Shallow clone plain JS object\n    clone: function (object) {\n        var cloned = {};\n        for (var key in object) {\n            cloned[key] = object[key];\n        }\n        return cloned;\n    }\n};\n// `map` and `clone` helpers for arrays.\nexport var arrayHelpers = {\n    // Shallow clone array\n    clone: function (array) {\n        return array.slice();\n    },\n    remove: function (array, i) {\n        array.splice(i, 1);\n        return array;\n    },\n    // Map through the link to array\n    map: function (link, iterator) {\n        var length = link.value.length, mapped = Array(length);\n        for (var i = 0, j = 0; i < length; i++) {\n            var y = iterator(link.at(i), i);\n            y === void 0 || (mapped[j++] = y);\n        }\n        mapped.length === j || (mapped.length = j);\n        return mapped;\n    }\n};\n//# sourceMappingURL=helpers.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport * as React from 'react';\nimport { Link } from './link';\nvar LinkedComponent = /** @class */ (function (_super) {\n    __extends(LinkedComponent, _super);\n    function LinkedComponent() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.links = null;\n        return _this;\n    }\n    LinkedComponent.prototype.linkAt = function (key) {\n        return linkAt(this, key);\n    };\n    LinkedComponent.prototype.linkAll = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return linkAll(this, args);\n    };\n    return LinkedComponent;\n}(React.Component));\nexport { LinkedComponent };\nLink.all = function (component) {\n    var _keys = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        _keys[_i - 1] = arguments[_i];\n    }\n    return linkAll(component, _keys);\n};\nLink.state = linkAt;\nfunction linkAll(component, _keys) {\n    var state = component.state, cache = component.links || (component.links = {}), keys = _keys.length ? _keys : Object.keys(state);\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        var value = state[key], cached = cache[key];\n        if (!cached || cached.value !== value) {\n            cache[key] = new StateLink(component, key, value);\n        }\n    }\n    return cache;\n}\nfunction linkAt(component, key) {\n    var value = component.state[key], cache = component.links || (component.links = {}), cached = cache[key];\n    return cached && cached.value === value ? cached : cache[key] = new StateLink(component, key, value);\n}\nvar StateLink = /** @class */ (function (_super) {\n    __extends(StateLink, _super);\n    function StateLink(component, key, value) {\n        var _this = _super.call(this, value) || this;\n        _this.component = component;\n        _this.key = key;\n        return _this;\n    }\n    StateLink.prototype.set = function (x) {\n        var attrs = {};\n        attrs[this.key] = x;\n        this.component.setState(attrs);\n    };\n    return StateLink;\n}(Link));\nexport { StateLink };\n//# sourceMappingURL=component.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * Advanced React links for purely functional two-way data binding\n *\n * MIT License, (c) 2016 Vlad Balin, Volicon.\n */\nimport { helpers, arrayHelpers } from './helpers';\n// Main Link class. All links must extend it.\nvar Link = /** @class */ (function () {\n    // create \n    function Link(value) {\n        this.value = value;\n    }\n    // Create custom link to arbitrary value\n    Link.value = function (value, set) {\n        return new CustomLink(value, set);\n    };\n    Object.defineProperty(Link.prototype, \"validationError\", {\n        // DEPRECATED: Old error holder for backward compatibility with Volicon code base\n        get: function () { return this.error; },\n        enumerable: true,\n        configurable: true\n    });\n    Link.prototype.onChange = function (handler) {\n        var _this = this;\n        return new CloneLink(this, function (x) {\n            handler(x);\n            _this.set(x);\n        });\n    };\n    Object.defineProperty(Link.prototype, \"props\", {\n        // <input { ...link.props } />\n        get: function () {\n            var _this = this;\n            return typeof this.value === 'boolean' ? {\n                checked: this.value,\n                onChange: function (e) { return _this.set(Boolean(e.target.checked)); }\n            } : {\n                value: this.value,\n                onChange: function (e) { return _this.set(e.target.value); }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // DEPRECATED: Old React method for backward compatibility\n    Link.prototype.requestChange = function (x) {\n        this.set(x);\n    };\n    // Immediately update the link value using given transform function.\n    Link.prototype.update = function (transform, e) {\n        var next = transform(this.clone(), e);\n        next === void 0 || this.set(next);\n    };\n    // Create new link which applies transform function on set.\n    Link.prototype.pipe = function (handler) {\n        var _this = this;\n        return new CloneLink(this, function (x) {\n            var next = handler(x, _this.value);\n            next === void 0 || _this.set(next);\n        });\n    };\n    // Create UI event handler function which will update the link with a given transform function.\n    Link.prototype.action = function (transform) {\n        var _this = this;\n        return function (e) { return _this.update(transform, e); };\n    };\n    Link.prototype.equals = function (truthyValue) {\n        return new EqualsLink(this, truthyValue);\n    };\n    Link.prototype.enabled = function (defaultValue) {\n        return new EnabledLink(this, defaultValue || \"\");\n    };\n    // Array-only links methods\n    Link.prototype.contains = function (element) {\n        return new ContainsLink(this, element);\n    };\n    Link.prototype.push = function () {\n        var array = arrayHelpers.clone(this.value);\n        Array.prototype.push.apply(array, arguments);\n        this.set(array);\n    };\n    Link.prototype.unshift = function () {\n        var array = arrayHelpers.clone(this.value);\n        Array.prototype.unshift.apply(array, arguments);\n        this.set(array);\n    };\n    Link.prototype.splice = function () {\n        var array = arrayHelpers.clone(this.value);\n        Array.prototype.splice.apply(array, arguments);\n        this.set(array);\n    };\n    Link.prototype.map = function (iterator) {\n        return helpers(this.value).map(this, iterator);\n    };\n    Link.prototype.removeAt = function (key) {\n        var value = this.value, _ = helpers(value);\n        this.set(_.remove(_.clone(value), key));\n    };\n    Link.prototype.at = function (key) {\n        return new LinkAt(this, key);\n    };\n    Link.prototype.clone = function () {\n        var value = this.value;\n        return helpers(value).clone(value);\n    };\n    Link.prototype.pick = function () {\n        var links = {};\n        for (var i = 0; i < arguments.length; i++) {\n            var key = arguments[i];\n            links[key] = new LinkAt(this, key);\n        }\n        return links;\n    };\n    /**\n     * Validate link with validness predicate and optional custom error object. Can be chained.\n     */\n    Link.prototype.check = function (whenValid, error) {\n        if (!this.error && !whenValid(this.value)) {\n            this.error = error || whenValid.error || defaultError;\n        }\n        return this;\n    };\n    return Link;\n}());\nexport { Link };\nvar CustomLink = /** @class */ (function (_super) {\n    __extends(CustomLink, _super);\n    function CustomLink(value, set) {\n        var _this = _super.call(this, value) || this;\n        _this.set = set;\n        return _this;\n    }\n    CustomLink.prototype.set = function (x) { };\n    return CustomLink;\n}(Link));\nexport { CustomLink };\nvar CloneLink = /** @class */ (function (_super) {\n    __extends(CloneLink, _super);\n    function CloneLink(parent, set) {\n        var _this = _super.call(this, parent.value) || this;\n        _this.set = set;\n        var error = parent.error;\n        if (error)\n            _this.error = error;\n        return _this;\n    }\n    CloneLink.prototype.set = function (x) { };\n    return CloneLink;\n}(Link));\nexport { CloneLink };\nvar EqualsLink = /** @class */ (function (_super) {\n    __extends(EqualsLink, _super);\n    function EqualsLink(parent, truthyValue) {\n        var _this = _super.call(this, parent.value === truthyValue) || this;\n        _this.parent = parent;\n        _this.truthyValue = truthyValue;\n        return _this;\n    }\n    EqualsLink.prototype.set = function (x) {\n        this.parent.set(x ? this.truthyValue : null);\n    };\n    return EqualsLink;\n}(Link));\nexport { EqualsLink };\nvar EnabledLink = /** @class */ (function (_super) {\n    __extends(EnabledLink, _super);\n    function EnabledLink(parent, defaultValue) {\n        var _this = _super.call(this, parent.value != null) || this;\n        _this.parent = parent;\n        _this.defaultValue = defaultValue;\n        return _this;\n    }\n    EnabledLink.prototype.set = function (x) {\n        this.parent.set(x ? this.defaultValue : null);\n    };\n    return EnabledLink;\n}(Link));\nexport { EnabledLink };\nvar ContainsLink = /** @class */ (function (_super) {\n    __extends(ContainsLink, _super);\n    function ContainsLink(parent, element) {\n        var _this = _super.call(this, parent.value.indexOf(element) >= 0) || this;\n        _this.parent = parent;\n        _this.element = element;\n        return _this;\n    }\n    ContainsLink.prototype.set = function (x) {\n        var _this = this;\n        var next = Boolean(x);\n        if (this.value !== next) {\n            var arr = this.parent.value, nextValue = x ? arr.concat(this.element) : arr.filter(function (el) { return el !== _this.element; });\n            this.parent.set(nextValue);\n        }\n    };\n    return ContainsLink;\n}(Link));\nexport { ContainsLink };\nvar defaultError = 'Invalid value';\n/**\n * Link to array or object element enclosed in parent link.\n * Performs purely functional update of the parent, shallow copying its value on `set`.\n */\nvar LinkAt = /** @class */ (function (_super) {\n    __extends(LinkAt, _super);\n    function LinkAt(parent, key) {\n        var _this = _super.call(this, parent.value[key]) || this;\n        _this.parent = parent;\n        _this.key = key;\n        return _this;\n    }\n    LinkAt.prototype.remove = function () {\n        this.parent.removeAt(this.key);\n    };\n    // Set new element value to parent array or object, performing purely functional update.\n    LinkAt.prototype.set = function (x) {\n        var _this = this;\n        if (this.value !== x) {\n            this.parent.update(function (value) {\n                value[_this.key] = x;\n                return value;\n            });\n        }\n    };\n    ;\n    return LinkAt;\n}(Link));\nexport { LinkAt };\n//# sourceMappingURL=link.js.map"],"names":["helpers","value","Object","getPrototypeOf","ArrayProto","arrayHelpers","ObjectProto","objectHelpers","dummyHelpers","linkAll","component","_keys","state","cache","links","_i","keys_1","length","keys","key","cached","StateLink","linkAt","Array","prototype","clone","map","link","fun","remove","iterator","mapped","element","at","push","object","cloned","array","slice","i","splice","j","y","__extends","this","extendStatics","setPrototypeOf","__proto__","d","b","p","hasOwnProperty","__","constructor","create","Link","set","CustomLink","defineProperty","get","error","enumerable","configurable","onChange","handler","_this","CloneLink","x","checked","e","Boolean","target","requestChange","update","transform","next","pipe","action","equals","truthyValue","EqualsLink","enabled","defaultValue","EnabledLink","contains","ContainsLink","apply","arguments","unshift","removeAt","_","LinkAt","pick","check","whenValid","defaultError","_super","call","parent","indexOf","arr","nextValue","concat","filter","el","LinkedComponent","args","React.Component","Link$1","all","attrs","setState"],"mappings":"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"}